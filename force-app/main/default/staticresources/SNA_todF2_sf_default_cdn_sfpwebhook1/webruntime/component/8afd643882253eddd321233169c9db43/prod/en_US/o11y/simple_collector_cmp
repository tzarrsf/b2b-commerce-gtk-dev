(function() { LWR.define("o11y/core_envelope",["exports","o11y/shared"],function(e,t){const s="o11y";class i{constructor(){this._envelope={diagnostics:{key:s,generatedTimestamp:void 0,bundleCount:0,bucketHistogramCount:0,upCounterCount:0,valueRecorderCount:0,schemaVersion:"252.11.0"},bundles:[],metrics:{bucketHistograms:[],upCounters:[],valueRecorders:[]},staticAttributes:{}}}withStaticAttributes(e){return this._envelope.staticAttributes=e,this}withLogs(e,t){let s=this._envelope.bundles.find(t=>t.schemaName===e);if(s)for(const e of t)s.messages.push(e);else s={schemaName:e,messages:t},this._envelope.bundles.push(s);return this._envelope.diagnostics.bundleCount=this._envelope.bundles.length,this}static getUpCounters(e,s=!0){return t.metricsUtility.getUpCounters(e,s)}static getValueRecorders(e,s=!0){return t.metricsUtility.getValueRecorders(e,s)}static getBucketHistograms(e,s=!0){return t.metricsUtility.getBucketHistograms(e,s)}withUpCounters(e){for(const t of e)this._envelope.metrics.upCounters.push(t);return this._envelope.diagnostics.upCounterCount=this._envelope.metrics.upCounters.length,this}withValueRecorders(e){for(const t of e)this._envelope.metrics.valueRecorders.push(t);return this._envelope.diagnostics.valueRecorderCount=this._envelope.metrics.valueRecorders.length,this}withBucketHistograms(e){for(const t of e)this._envelope.metrics.bucketHistograms.push(t);return this._envelope.diagnostics.bucketHistogramCount=this._envelope.metrics.bucketHistograms.length,this}build(){return this._envelope.diagnostics.generatedTimestamp=t.utility.time().tsNow,this._envelope}static buildFrom(e){const s=new i;return e.staticAttributes&&s.withStaticAttributes(e.staticAttributes),e.messages&&e.messages.forEach((e,i)=>{s.withLogs(t.schemaUtil.getSchemaId(i),e)}),e.upCounters&&s.withUpCounters(e.upCounters),e.valueRecorders&&s.withValueRecorders(e.valueRecorders),e.bucketHistograms&&s.withBucketHistograms(e.bucketHistograms),s.build()}}e.CoreEnvelopeBuilder=i,e.coreEnvelopeKey=s,Object.defineProperty(e,"__esModule",{value:!0})});
})();(function() { LWR.define("o11y/simple_collector",["exports","o11y/core_envelope","o11y/shared"],function(e,t,s){e.SimpleCollector=class{constructor(e){this._messageSize=0,this._isCollecting=!1;let t=1e4;if(e){const i=e.environment;i&&(this._staticAttributes={appName:i.appName,appVersion:i.appVersion,appExperience:i.appExperience,deviceId:i.deviceId,deviceModel:i.deviceModel,sdkVersion:i.sdkVersion}),s.utility.requireArgumentIfDefined(e.precollectCallback,"options.precollectCallback","function")&&(this._precollectCallback=e.precollectCallback);const r=e.maxUniqueSchemas;if(void 0!==r){if("number"!=typeof r||!(r>0))throw new Error("options.maxUniqueSchemas, if defined, must be > 0");t=r}}this._messageBuffers=new s.LazyMapToList(t)}collect(e,t,i){var r;if(!this._isCollecting){this._isCollecting=!0;try{const o={timestamp:i.timestamp,data:t,age:i.age,rootId:i.rootId,seq:i.sequence,sseq:i.schemaSequence,loggerName:i.loggerName,pagePayload:i.pagePayload,loggerAppName:i.loggerAppName,connectionType:i.connectionType,appPayload:i.appPayload,csId:i.clientSessionId,recCsId:i.receiverClientSessionId,recRootId:i.receiverRootId};if(!1===(null===(r=this._precollectCallback)||void 0===r?void 0:r.call(this,e,o)))return;if(!this._messageBuffers.push(e,o))throw new Error(`Buffer is full. Refusing schemaId ${s.schemaUtil.getSchemaId(e)}`);this._messageSize+=s.utility.estimateObjectSize(o)}finally{this._isCollecting=!1}}}get estimatedByteSize(){return this._messageSize+8*this.metricsCount}get hasData(){return this.messagesCount>0||this.metricsCount>0}get messagesCount(){return this._messageBuffers.totalItemCount}get metricsCount(){let e=0;return this._metricsExtractors&&(e+=this._metricsExtractors.getAllUpCounters().length,e+=this._metricsExtractors.getAllValueRecorders().length,e+=this._metricsExtractors.getAllBucketHistograms().length),e}getRawContentsOfCoreEnvelope(){const e={staticAttributes:this._staticAttributes,messages:this._messageBuffers.getAllMessages(!0)};return this._metricsExtractors&&(e.upCounters=t.CoreEnvelopeBuilder.getUpCounters(this._metricsExtractors.getAllUpCounters(),!0),e.valueRecorders=t.CoreEnvelopeBuilder.getValueRecorders(this._metricsExtractors.getAllValueRecorders(),!0),e.bucketHistograms=t.CoreEnvelopeBuilder.getBucketHistograms(this._metricsExtractors.getAllBucketHistograms(),!0)),this._messageSize=0,e}receiveMetricsExtractors(e){this._metricsExtractors=e}},Object.defineProperty(e,"__esModule",{value:!0})});
})();